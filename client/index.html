<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"
        integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <title>Document</title>
</head>

<body>
    <div class="container  body-content">
        <div class="row">
            <div class="col-12 justify-content-center">
                <h1 class="justify-content-center">Client</h1>
            </div>
        </div>
        <hr>
        <div class="row">
            <div class="col-sm">
                <form id="formRegister">
                    <div class="">
                        <h1>Registrar</h1>
                    </div>
                    <div class=" justify-content-start" style="padding-top:10px;">
                        <label>NOME:</label>
                    </div>
                    <div class=" justify-content-center" style="padding-top:10px;">
                        <input class="form-control" name="username" required></input>
                    </div>
                    <div class=" justify-content-start" style="padding-top:10px;">
                        <label>EMAIL:</label>
                    </div>
                    <div class=" justify-content-center" style="padding-top:10px;">
                        <input class="form-control" name="email" required></input>
                    </div>
                    <div class=" justify-content-start" style="padding-top:10px;">
                        <label>SENHA:</label>
                    </div>
                    <div class=" justify-content-center" style="padding-top:10px;">
                        <input class="form-control" type="password" name="password" required></input>
                    </div>
                    <div class=" justify-content-end" style="padding-top:10px;">
                        <button class="btn btn-primary">REGISTRAR</button>
                    </div>
                </form>
            </div>
            <div class="col-sm">
                <div class="">
                    <h1>Login</h1>
                </div>
                <form id="formLogin">
                    <div class="justify-content-start" style="padding-top:10px;">
                        <label>EMAIL:</label>
                    </div>
                    <div class=" justify-content-center" style="padding-top:10px;">
                        <input class="form-control" name="email" required></input>
                    </div>
                    <div class=" justify-content-start" style="padding-top:10px;">
                        <label>SENHA:</label>
                    </div>
                    <div class=" justify-content-center" style="padding-top:10px;">
                        <input class="form-control" type="password" name="password" required></input>
                    </div>
                    <div class=" justify-content-end" style="padding-top:10px;">
                        <button class="btn btn-primary">ENTRAR</button>
                    </div>
                </form>
            </div>
        </div>
        <hr>
        <div class="row">
            <div class="col-12">
                <button id="btnMostrarUsuarioAuth" class="btn btn-primary">
                    Mostrar Usu√°rio Autenticado
                </button>

                <button id="btnLogout" class="btn btn-primary">
                    Logout
                </button>
            </div>
        </div>
        <div class="row">
            <div class="col-12" id="mostrar-usuario">
            </div>
        </div>
    </div>

    <script>
        const formRegister = document.getElementById('formRegister');
        const formLogin = document.getElementById('formLogin');

        const baseUrl = 'http://127.0.0.1:3004';

        formRegister.onsubmit = () => {

            var form = new FormData(formRegister);

            fetch(baseUrl + "/register", {
                method: "POST",
                body: form,
                mode: 'cors',
                credentials: 'include'
            }).then(response => {
                if (response.status == 200) {
                    return response.json();
                } else {
                    throw new Error('Ops! Houve um erro em nosso servidor.');
                }
                return response => response.blob();
            }).then(response => {
                window.localStorage.setItem('user', JSON.stringify(response));
            }).catch(error => {
                console.error(error);
            });

            return false;
        }
        formLogin.onsubmit = () => {
            var form = new FormData(formLogin);

            fetch(baseUrl + "/login", {
                method: "POST",
                body: form,
                mode: 'cors',
                credentials: 'include'
            }).then(response => {
                if (response.status == 200) {
                    return response.json();
                } else {
                    throw new Error('Ops! Houve um erro em nosso servidor.');
                }
                return response => response.blob();
            }).then(response => {
                window.localStorage.setItem('user', JSON.stringify(response));
            }).catch(error => {
                console.error(error);
            });

            return false;
        }

        document.getElementById('btnMostrarUsuarioAuth').onclick = () => {
            const { id } = JSON.parse(window.localStorage.getItem('user'));
            fetch(baseUrl + "/users/" + id, {
                method: "GET",
                mode: 'cors',
                credentials: 'include'
            }).then(response => {
                return response.status == 200 ? response.json() : response.statusText;
            }).then(response => {
                document.getElementById('mostrar-usuario').innerHTML = JSON.stringify(response);
            }).catch(error => {
                console.error(error);
            });
        }

        document.getElementById('btnLogout').onclick = () => {
            fetch(baseUrl + '/logout', {
                method: "GET",
                mode: 'cors',
                credentials: 'include'
            }).then(response => {
                return response.status === 200 ? response.json() : response.statusText;
            }).then(response => {
                console.log(response);
            })
        }
    </script>
</body>

</html>